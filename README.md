
![bcplbook_](https://github.com/user-attachments/assets/f41a992b-e09a-4a7d-b0b5-c7209550ceac)

# BCPL Interpreters

The language that inspired C, powered the first MUD and helped make the Amiga operating system!

This repository contains BCPL INTCODE interpreter implementations in multiple languages.

## Available Implementations

| Directory | Language | Description |
|-----------|----------|-------------|
| `bcpl-js-console` | JavaScript/Node.js | Handy go-to if you have Node.js on your system. Pretty fast. |
| `bcpl-python-console` | Python | Pure Python - functional and portable. A bit slow though. |
| `bcpl-rust-console` | Rust | High-performance implementation with zero dependencies. |

Ported from the C version at https://sourceforge.net/projects/bcpl-c64/ <br>
For a browser version look at https://github.com/dagfinndybvig/onlineBCPL <br>
More or less compatible with the classic book https://archive.org/details/richards1979bcpl/mode/2up<br><br>
The conversions were effected with extensive use of Github Copilot coding agent. As well as contributing towards the preservation of BCPL, it demonstrates that coding agents can do far more than frontend and boilerplate. In fact, this is en effect low-level programming, involving virtual machines.

Models used: Gemini 3 Pro, Claude Sonnet 4.5, Claude Opus 4.5 and more. The use of coding agents removes the last excuse not to preserve great software!<br><br>
This project is made in honour of Martin Richards, the creator of BCPL.<br>

---

# BCPL JS Console

This is a JavaScript port of the BCPL INTCODE interpreter (`icint.c`).
It allows compiling and running BCPL programs in a Node.js environment.

## Files

- `icint.js`: The main interpreter and assembler (ported from `icint.c`).
- `syni`: The syntax analyzer (INTCODE).
- `trni`: The translator (INTCODE).
- `cgi`: The code generator (INTCODE).
- `libhdr`: The standard library header.
- `test.b`: A sample BCPL program.

## Source Code and Generated Files

### Source Code
The source code for your program is a `.b` file (e.g., `test.b`). You can create your own BCPL files in this directory.
- **Input**: `filename.b` (Your BCPL source code)
- **Library**: `libhdr` (Standard library header, usually included via `GET "LIBHDR"`)

### Generated Files
The compilation process generates the following intermediate and final files in the current directory:

1. **`OCODE`**: Intermediate code generated by the first pass (`syni` + `trni`).
   - *Note*: The compiler writes specifically to a file named `OCODE` in the current working directory.
2. **`INTCODE`**: The final executable bytecode generated by the code generator (`cgi`).
   - *Note*: This is the output of the `cgi` pass, which we capture from stdout or file output.

## Usage

### Automated Compilation and Execution

Use the `compile.sh` script to compile and run a BCPL program:

```bash
./compile.sh test.b
./compile.sh test.b -iINPUT -oOUTPUT
```

### Manual Steps

1. **Prepare the compiler:**
   Concatenate `syni` and `trni` (removing the `Z` from `trni`) to create `synitrni`.
   ```bash
   cat syni > synitrni
   tail -n +4 trni >> synitrni
   ```

2. **Compile BCPL to OCODE:**
   ```bash
   node icint.js synitrni -itest.b
   ```
   This produces an `OCODE` file.

3. **Compile OCODE to INTCODE:**
   ```bash
   node icint.js cgi -iOCODE > INTCODE
   ```
   This produces an `INTCODE` file.

4. **Run INTCODE:**
   ```bash
   node icint.js INTCODE
   ```

## Implementation Details

- The interpreter uses 16-bit signed arithmetic to match the original C implementation.
- `syni` and `trni` are concatenated to share the label namespace (or rather, to avoid clearing labels between passes, although they mostly use globals).
- `trni` writes directly to a file named `OCODE` (ignoring standard output redirection for the code itself).

---

# BCPL Python Console

This is a Python port of the BCPL INTCODE interpreter. It is ready to go and works with any Python 3 installation.

## Usage

```bash
cd bcpl-python-console
./compile.sh test.b
./compile.sh test.b -iINPUT -oOUTPUT
```

For better performance, use PyPy instead of CPython. See `bcpl-python-console/README.md` for details.

FOR A SPECIFIC COMPILE.BAT FOR PYTHON/WINDOWS ALSO SEE THE PYTHON DIRECTORY

---

# BCPL Rust Console

This is a Rust port of the BCPL INTCODE interpreter, offering high performance and zero external dependencies. Instructions included to install Rust to build the system locally.

## Building

```bash
cd bcpl-rust-console
cargo build --release
```

## Usage

```bash
./compile.sh test.b
./compile.sh test.b -iINPUT -oOUTPUT
```

See `bcpl-rust-console/README.md` for detailed documentation.

---

# Contributing

If you have cloned this repository to a peripheral computer and made additions, here's how to push them back to the central repository:

### Important: Build Artifacts

This repository includes a `.gitignore` file that automatically excludes generated files from version control:
- `OCODE`, `INTCODE`, `INTCODE_RAW` (compilation outputs)
- `synitrni` (generated by concatenating `syni` and `trni`)
- `node_modules/` (Node.js dependencies)

These files are generated during compilation and should never be committed. The `.gitignore` ensures you won't accidentally commit them.

### For Direct Contributors (with write access)

1. **Check the status of your changes:**
   ```bash
   git status
   ```

2. **Add your changes to the staging area:**
   ```bash
   git add .
   # Or add specific files:
   git add path/to/file1 path/to/file2
   ```

3. **Commit your changes with a descriptive message:**
   ```bash
   git commit -m "Description of your changes"
   ```

4. **Push your changes to the central repository:**
   ```bash
   git push origin main
   # Or if you're on a different branch:
   git push origin your-branch-name
   ```

### For External Contributors (without write access)

1. **Fork the repository** on GitHub (click the "Fork" button on the repository page).

2. **Add your fork as a remote** (if not already done):
   ```bash
   git remote add fork https://github.com/YOUR_USERNAME/nodeBCPL.git
   ```

3. **Create a new branch for your changes:**
   ```bash
   git checkout -b my-feature-branch
   ```

4. **Add and commit your changes:**
   ```bash
   git add .
   git commit -m "Description of your changes"
   ```

5. **Push to your fork:**
   ```bash
   git push fork my-feature-branch
   ```

6. **Create a Pull Request** on GitHub:
   - Go to the original repository on GitHub
   - Click "New Pull Request"
   - Select your fork and branch
   - Provide a clear description of your changes
   - Submit the pull request

### Before Pushing

Always ensure your local repository is up to date with the central repository:

```bash
git pull origin main
```

This helps avoid merge conflicts and ensures your changes are based on the latest code.

---
